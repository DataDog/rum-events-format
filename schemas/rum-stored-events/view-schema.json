{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "rum-stored-events/view-schema.json",
    "title": "RumStoredViewEvent",
    "type": "object",
    "description": "Schema of all properties of a stored View event",
    "allOf": [
        {
            "type": "object",
            "properties": {
                "client_time": {
                    "type": "number"
                },
                "datadog.index": {
                    "type": "string"
                },
                "discovery_timestamp": {
                    "type": "number"
                },
                "event_id": {
                    "type": "string"
                },
                "hashes": {
                    "type": "object",
                    "properties": {
                        "session": {
                            "$ref": "#/$defs/hash_id"
                        },
                        "view": {
                            "$ref": "#/$defs/hash_id"
                        },
                        "usr": {
                            "$ref": "#/$defs/hash_id"
                        }
                    }
                },
                "id": {
                    "type": "string"
                },
                "ingest_size_in_bytes": {
                    "type": "number"
                },
                "intake_time": {
                    "type": "number"
                },
                "random_draw": {
                    "type": "number"
                },
                "service": {
                    "type": "string"
                },
                "source": {
                    "type": "string"
                },
                "source_fragment_id": {
                    "type": "string"
                },
                "tag": {
                    "type": "object",
                    "patternProperties": {
                        ".*": {
                            "$ref": "#/$defs/tag"
                        }
                    }
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "tiebreaker": {
                    "type": "number"
                },
                "timeline": {
                    "type": "object",
                    "properties": {
                        "token": {
                            "type": "string"
                        }
                    }
                },
                "timestamp": {
                    "type": "string"
                }
            }
        },
        {
            "required": [
                "custom"
            ],
            "properties": {
                "custom": {
                    "type": "object",
                    "description": "Custom properties of the event",
                    "required": [
                        "type",
                        "view",
                        "_dd"
                    ],
                    "properties": {
                        "type": {
                            "type": "string",
                            "description": "RUM event type",
                            "const": "view"
                        },
                        "view": {
                            "type": "object",
                            "description": "View properties",
                            "required": [
                                "id",
                                "url",
                                "time_spent",
                                "action",
                                "error",
                                "resource"
                            ],
                            "properties": {
                                "loading_time": {
                                    "type": "integer",
                                    "description": "Duration in ns to the view is considered loaded",
                                    "minimum": 0
                                },
                                "loading_type": {
                                    "type": "string",
                                    "description": "Type of the loading of the view",
                                    "enum": [
                                        "initial_load",
                                        "route_change",
                                        "activity_display",
                                        "activity_redisplay",
                                        "fragment_display",
                                        "fragment_redisplay",
                                        "view_controller_display",
                                        "view_controller_redisplay"
                                    ]
                                },
                                "time_spent": {
                                    "type": "integer",
                                    "description": "Time spent on the view in ns",
                                    "minimum": 0
                                },
                                "first_contentful_paint": {
                                    "type": "integer",
                                    "description": "Duration in ns to the first rendering",
                                    "minimum": 0
                                },
                                "largest_contentful_paint": {
                                    "type": "integer",
                                    "description": "Duration in ns to the largest contentful paint",
                                    "minimum": 0
                                },
                                "largest_contentful_paint_target_selector": {
                                    "type": "string",
                                    "description": "CSS selector path of the largest contentful paint element"
                                },
                                "first_input_delay": {
                                    "type": "integer",
                                    "description": "Duration in ns of the first input event delay",
                                    "minimum": 0
                                },
                                "first_input_time": {
                                    "type": "integer",
                                    "description": "Duration in ns to the first input",
                                    "minimum": 0
                                },
                                "first_input_target_selector": {
                                    "type": "string",
                                    "description": "CSS selector path of the first input target element"
                                },
                                "interaction_to_next_paint": {
                                    "type": "integer",
                                    "description": "Longest duration in ns between an interaction and the next paint",
                                    "minimum": 0
                                },
                                "interaction_to_next_paint_time": {
                                    "type": "integer",
                                    "description": "Duration in ns between start of the view and start of the INP",
                                    "minimum": 0
                                },
                                "interaction_to_next_paint_target_selector": {
                                    "type": "string",
                                    "description": "CSS selector path of the interacted element corresponding to INP"
                                },
                                "cumulative_layout_shift": {
                                    "type": "number",
                                    "description": "Total layout shift score that occurred on the view",
                                    "minimum": 0
                                },
                                "cumulative_layout_shift_time": {
                                    "type": "integer",
                                    "description": "Duration in ns between start of the view and start of the largest layout shift contributing to CLS",
                                    "minimum": 0
                                },
                                "cumulative_layout_shift_target_selector": {
                                    "type": "string",
                                    "description": "CSS selector path of the first element (in document order) of the largest layout shift contributing to CLS"
                                },
                                "dom_complete": {
                                    "type": "integer",
                                    "description": "Duration in ns to the complete parsing and loading of the document and its sub resources",
                                    "minimum": 0
                                },
                                "dom_content_loaded": {
                                    "type": "integer",
                                    "description": "Duration in ns to the complete parsing and loading of the document without its sub resources",
                                    "minimum": 0
                                },
                                "dom_interactive": {
                                    "type": "integer",
                                    "description": "Duration in ns to the end of the parsing of the document",
                                    "minimum": 0
                                },
                                "load_event": {
                                    "type": "integer",
                                    "description": "Duration in ns to the end of the load event handler execution",
                                    "minimum": 0
                                },
                                "first_byte": {
                                    "type": "integer",
                                    "description": "Duration in ns to the response start of the document request",
                                    "minimum": 0
                                },
                                "custom_timings": {
                                    "type": "object",
                                    "description": "User custom timings of the view. As timing name is used as facet path, it must contain only letters, digits, or the characters - _ . @ $",
                                    "additionalProperties": {
                                        "type": "integer",
                                        "minimum": 0
                                    }
                                },
                                "is_active": {
                                    "type": "boolean",
                                    "description": "Whether the View corresponding to this event is considered active"
                                },
                                "is_slow_rendered": {
                                    "type": "boolean",
                                    "description": "Whether the View had a low average refresh rate"
                                },
                                "action": {
                                    "type": "object",
                                    "description": "Properties of the actions of the view",
                                    "required": [
                                        "count"
                                    ],
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of actions that occurred on the view",
                                            "minimum": 0
                                        }
                                    }
                                },
                                "error": {
                                    "type": "object",
                                    "description": "Properties of the errors of the view",
                                    "required": [
                                        "count"
                                    ],
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of errors that occurred on the view",
                                            "minimum": 0
                                        }
                                    }
                                },
                                "crash": {
                                    "type": "object",
                                    "description": "Properties of the crashes of the view",
                                    "required": [
                                        "count"
                                    ],
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of crashes that occurred on the view",
                                            "minimum": 0
                                        }
                                    }
                                },
                                "long_task": {
                                    "type": "object",
                                    "description": "Properties of the long tasks of the view",
                                    "required": [
                                        "count"
                                    ],
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of long tasks that occurred on the view",
                                            "minimum": 0
                                        }
                                    }
                                },
                                "frozen_frame": {
                                    "type": "object",
                                    "description": "Properties of the frozen frames of the view",
                                    "required": [
                                        "count"
                                    ],
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of frozen frames that occurred on the view",
                                            "minimum": 0
                                        }
                                    }
                                },
                                "resource": {
                                    "type": "object",
                                    "description": "Properties of the resources of the view",
                                    "required": [
                                        "count"
                                    ],
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of resources that occurred on the view",
                                            "minimum": 0
                                        }
                                    }
                                },
                                "frustration": {
                                    "type": "object",
                                    "description": "Properties of the frustrations of the view",
                                    "required": [
                                        "count"
                                    ],
                                    "properties": {
                                        "count": {
                                            "type": "integer",
                                            "description": "Number of frustrations that occurred on the view",
                                            "minimum": 0
                                        }
                                    }
                                },
                                "in_foreground_periods": {
                                    "type": "array",
                                    "description": "List of the periods of time the user had the view in foreground (focused in the browser)",
                                    "items": {
                                        "type": "object",
                                        "description": "Properties of the foreground period of the view",
                                        "required": [
                                            "duration",
                                            "start"
                                        ],
                                        "properties": {
                                            "start": {
                                                "type": "integer",
                                                "description": "Duration in ns between start of the view and start of foreground period",
                                                "minimum": 0
                                            },
                                            "duration": {
                                                "type": "integer",
                                                "description": "Duration in ns of the view foreground period",
                                                "minimum": 0
                                            }
                                        }
                                    }
                                },
                                "memory_average": {
                                    "type": "number",
                                    "description": "Average memory used during the view lifetime (in bytes)"
                                },
                                "memory_max": {
                                    "type": "number",
                                    "description": "Peak memory used during the view lifetime (in bytes)"
                                },
                                "cpu_ticks_count": {
                                    "type": "number",
                                    "description": "Total number of cpu ticks during the view’s lifetime"
                                },
                                "cpu_ticks_per_second": {
                                    "type": "number",
                                    "description": "Average number of cpu ticks per second during the view’s lifetime"
                                },
                                "refresh_rate_average": {
                                    "type": "number",
                                    "description": "Average refresh rate during the view’s lifetime (in frames per second)"
                                },
                                "refresh_rate_min": {
                                    "type": "number",
                                    "description": "Minimum refresh rate during the view’s lifetime (in frames per second)"
                                },
                                "flutter_build_time": {
                                    "description": "Time taken for Flutter 'build' methods.",
                                    "allOf": [
                                        {
                                            "$ref": "#/$defs/perf_metric"
                                        }
                                    ]
                                },
                                "flutter_raster_time": {
                                    "description": "Time taken for Flutter to rasterize the view.",
                                    "allOf": [
                                        {
                                            "$ref": "#/$defs/perf_metric"
                                        }
                                    ]
                                },
                                "js_refresh_rate": {
                                    "description": "The JavaScript refresh rate for React Native",
                                    "allOf": [
                                        {
                                            "$ref": "#/$defs/perf_metric"
                                        }
                                    ]
                                }
                            }
                        },
                        "session": {
                            "type": "object",
                            "description": "Session properties",
                            "required": [],
                            "properties": {
                                "is_active": {
                                    "type": "boolean",
                                    "description": "Whether this session is currently active. Set to false to manually stop a session",
                                    "default": true
                                },
                                "sampled_for_replay": {
                                    "type": "boolean",
                                    "description": "Whether this session has been sampled for replay"
                                }
                            }
                        },
                        "feature_flags": {
                            "type": "object",
                            "description": "Feature flags properties",
                            "additionalProperties": true
                        },
                        "privacy": {
                            "type": "object",
                            "description": "Privacy properties",
                            "required": [
                                "replay_level"
                            ],
                            "properties": {
                                "replay_level": {
                                    "type": "string",
                                    "description": "The replay privacy level",
                                    "enum": [
                                        "allow",
                                        "mask",
                                        "mask-user-input"
                                    ]
                                }
                            }
                        },
                        "_dd": {
                            "type": "object",
                            "description": "Internal properties",
                            "required": [
                                "document_version"
                            ],
                            "properties": {
                                "document_version": {
                                    "type": "integer",
                                    "description": "Version of the update of the view event",
                                    "minimum": 0
                                },
                                "page_states": {
                                    "type": "array",
                                    "description": "List of the page states during the view",
                                    "items": {
                                        "type": "object",
                                        "description": "Properties of the page state",
                                        "required": [
                                            "state",
                                            "start"
                                        ],
                                        "properties": {
                                            "state": {
                                                "enum": [
                                                    "active",
                                                    "passive",
                                                    "hidden",
                                                    "frozen",
                                                    "terminated"
                                                ],
                                                "description": "Page state name"
                                            },
                                            "start": {
                                                "type": "integer",
                                                "description": "Duration in ns between start of the view and start of the page state"
                                            }
                                        }
                                    }
                                },
                                "replay_stats": {
                                    "type": "object",
                                    "description": "Debug metadata for Replay Sessions",
                                    "properties": {
                                        "records_count": {
                                            "type": "integer",
                                            "description": "The number of records produced during this view lifetime",
                                            "default": 0,
                                            "minimum": 0
                                        },
                                        "segments_count": {
                                            "type": "integer",
                                            "description": "The number of segments sent during this view lifetime",
                                            "minimum": 0,
                                            "default": 0
                                        },
                                        "segments_total_raw_size": {
                                            "type": "integer",
                                            "description": "The total size in bytes of the segments sent during this view lifetime",
                                            "minimum": 0,
                                            "default": 0
                                        }
                                    }
                                },
                                "configuration": {
                                    "type": "object",
                                    "description": "Subset of the SDK configuration options in use during its execution",
                                    "properties": {
                                        "start_session_replay_recording_manually": {
                                            "type": "boolean",
                                            "description": "Whether session replay recording configured to start manually"
                                        }
                                    }
                                }
                            }
                        },
                        "display": {
                            "type": "object",
                            "description": "Display properties",
                            "properties": {
                                "scroll": {
                                    "type": "object",
                                    "description": "Scroll properties",
                                    "required": [
                                        "max_depth",
                                        "max_depth_scroll_top",
                                        "max_scroll_height",
                                        "max_scroll_height_time"
                                    ],
                                    "properties": {
                                        "max_depth": {
                                            "type": "number",
                                            "description": "Distance between the top and the lowest point reached on this view (in pixels)"
                                        },
                                        "max_depth_scroll_top": {
                                            "type": "number",
                                            "description": "Page scroll top (scrolled distance) when the maximum scroll depth was reached for this view (in pixels)"
                                        },
                                        "max_scroll_height": {
                                            "type": "number",
                                            "description": "Maximum page scroll height (total height) for this view (in pixels)"
                                        },
                                        "max_scroll_height_time": {
                                            "type": "number",
                                            "description": "Duration between the view start and the time the max scroll height was reached for this view (in nanoseconds)"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    ],
    "$defs": {
        "hash_id": {
            "type": "object",
            "required": [
                "id"
            ],
            "properties": {
                "id": {
                    "type": "number"
                }
            }
        },
        "tag": {
            "oneOf": [
                {
                    "type": "string"
                },
                {
                    "type": "object",
                    "patternProperties": {
                        ".*": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "perf_metric": {
            "type": "object",
            "required": [
                "min",
                "max",
                "average"
            ],
            "properties": {
                "min": {
                    "type": "number",
                    "description": "The minimum value seen for this metric during the view's lifetime."
                },
                "max": {
                    "type": "number",
                    "description": "The maximum value seen for this metric during the view's lifetime."
                },
                "average": {
                    "type": "number",
                    "description": "The average value for this metric during the view's lifetime."
                },
                "metric_max": {
                    "type": "number",
                    "description": "The maximum possible value we could see for this metric, if such a max is relevant and can vary from session to session."
                }
            }
        }
    }
}